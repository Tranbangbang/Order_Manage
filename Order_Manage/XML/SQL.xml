<?xml version="1.0" encoding="utf-8"?>
<Queries>

	<insert>
		<insert-via-code>
			INSERT INTO ViaCode (viaCode, email, createAt)
			VALUES (@ViaCode, @Email, @CreateAt)
		</insert-via-code>

		<insert-order>
			INSERT INTO Orders (OrderDate, AccountId)
			VALUES (@OrderDate, @AccountId);
			SELECT LAST_INSERT_ID();
		</insert-order>

		<insert-order-detail>
			INSERT INTO OrderDetails (OrderId, ProductId, Quantity)
			VALUES (@OrderId, @ProductId, @Quantity);
		</insert-order-detail>

		<insert-notification>
			INSERT INTO Notification (UserId, NotificationType, NotificationMessage, ReadFlg, RedirectUrl, UrlBody, CreatedAt, CreatedBy)
			VALUES (@UserId, @NotificationType, @NotificationMessage, @ReadFlg, @RedirectUrl, @UrlBody, @CreatedAt, @CreatedBy);
			SELECT LAST_INSERT_ID();
		</insert-notification>


		<insert-message>
			INSERT INTO Message (SenderId, ReceiverId, Content)
			VALUES (@SenderId, @ReceiverId, @Content);
		</insert-message>
		
	</insert>

	<select>
		<get-acc-by-Email>
			SELECT *
			FROM aspnetusers
			WHERE Email = @Email
		</get-acc-by-Email>

		<get-viaCode-by-Email>
			SELECT *
			FROM ViaCode
			WHERE Email = @Email
		</get-viaCode-by-Email>

		<get-user-orders>
			SELECT o.OrderId, o.OrderDate, od.OrderDetailId, od.ProductId, od.Quantity,
			p.ProductName, p.Price
			FROM Orders o
			INNER JOIN OrderDetails od ON o.OrderId = od.OrderId
			INNER JOIN Products p ON od.ProductId = p.ProductId
			WHERE o.AccountId = @AccountId
			ORDER BY o.OrderDate DESC;
		</get-user-orders>


		<get-user-notifications>
			SELECT NotificationId, UserId, NotificationType, NotificationMessage, ReadFlg, RedirectUrl, UrlBody, CreatedAt, CreatedBy
			FROM Notification
			WHERE UserId = @UserId
			ORDER BY CreatedAt DESC;
		</get-user-notifications>


		<get-chat-history>
			SELECT SenderId, ReceiverId, Content
			FROM Message
			WHERE (SenderId = @SenderId AND ReceiverId = @ReceiverId)
			OR (SenderId = @ReceiverId AND ReceiverId = @SenderId);
			
		</get-chat-history>
		
	</select>

	<update>
		<mark-notification-read>
			UPDATE Notification
			SET ReadFlg = 1
			WHERE NotificationId = @NotificationId;
		</mark-notification-read>
	</update>
	
	<delete>
		
	</delete>


</Queries>
